//@version=6
indicator("ICT FVG Gốc (3-Candle)", overlay=true)

// ============================= //
// ⚡ 1. INPUTS
// ============================= //
showBoxes   = input.bool(true, "Hiển thị FVG Box")
showCandles = input.bool(true, "Hiển thị 3 nến xác định FVG")

// ============================= //
// ⚡ 2. ICT FVG (3 nến)
// ============================= //
bullFVG = low > high[2]      // Gap nến thứ 3 cao hơn nến thứ 1
bearFVG = high < low[2]      // Gap nến thứ 3 thấp hơn nến thứ 1

// ============================= //
// ⚡ 3. VẼ FVG BOX
// ============================= //
var box[] boxes = array.new_box()

f_newFVG(direction, top, bottom) =>
    c = direction == 1 ? color.green : color.red
    b = box.new(bar_index - 2, top, bar_index, bottom, bgcolor=color.new(c, 80), border_color=color.new(c, 0))
    array.push(boxes, b)

if showBoxes
    if bullFVG
        f_newFVG(1, low, high[2])
    if bearFVG
        f_newFVG(-1, high, low[2])

// ============================= //
// ⚡ 4. MARK 3 NẾN
// ============================= //
if showCandles
    // Bullish FVG
    if bullFVG
        label.new(bar_index-2, high[2], "C1", style=label.style_label_down, color=color.new(color.yellow, 0), textcolor=color.black, size=size.tiny, yloc=yloc.abovebar)
        label.new(bar_index-1, low[1],  "C2", style=label.style_label_up,   color=color.new(color.orange, 0), textcolor=color.black, size=size.tiny, yloc=yloc.belowbar)
        label.new(bar_index,   low,     "C3", style=label.style_label_up,   color=color.new(color.blue, 0),   textcolor=color.white, size=size.tiny, yloc=yloc.belowbar)
    // Bearish FVG
    if bearFVG
        label.new(bar_index-2, low[2],  "C1", style=label.style_label_up,   color=color.new(color.yellow, 0), textcolor=color.black, size=size.tiny, yloc=yloc.belowbar)
        label.new(bar_index-1, high[1], "C2", style=label.style_label_down, color=color.new(color.orange, 0), textcolor=color.black, size=size.tiny, yloc=yloc.abovebar)
        label.new(bar_index,   high,    "C3", style=label.style_label_down, color=color.new(color.blue, 0),   textcolor=color.white, size=size.tiny, yloc=yloc.abovebar)

// ============================= //
// ⚡ 5. SIGNAL MARKERS (tuỳ chọn)
// ============================= //
plotshape(bullFVG, title="Bullish FVG", style=shape.triangleup, color=color.green, size=size.tiny, location=location.belowbar)
plotshape(bearFVG, title="Bearish FVG", style=shape.triangledown, color=color.red, size=size.tiny, location=location.abovebar)
